<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Панель администратора SELLIX</title>
</head>
<body>
<h1>SELLIX</h1>
<h2>Управление пользователями</h2>

<h3>Фильтры</h3>
<form th:action="@{/admin}" th:method="get" th:object="${filter}">
    <div>
        <label for="username">Имя пользователя:</label>
        <input id="username" type="text" name="username" th:value="${filter.username}">
    </div>
    <div>
        <label for="firstName">Имя:</label>
        <input id="firstName" type="text" name="firstName" th:value="${filter.firstName}">
    </div>
    <div>
        <label for="lastName">Фамилия:</label>
        <input id="lastName" type="text" name="lastName" th:value="${filter.lastName}">
    </div>
    <div>
        <label for="phoneNumber">Телефон:</label>
        <input id="phoneNumber" type="text" name="phoneNumber" th:value="${filter.phoneNumber}">
    </div>
    <div>
        <label for="role">Роль:</label>
        <select id="role" name="role">
            <option value="">Все роли</option>
            <option th:each="role : ${roles}"
                    th:value="${role}"
                    th:text="${role}"
                    th:selected="${filter.role == role}">
            </option>
        </select>
    </div>
    <div>
        <label>Статус:</label>
        <div>
            <input type="radio" id="statusAll" name="status" value="" th:checked="${filter.status == null}">
            <label for="statusAll">Все</label>
            <input type="radio" id="statusActive" name="status" value="true" th:checked="${filter.status == true}">
            <label for="statusActive">Активный</label>
            <input type="radio" id="statusInactive" name="status" value="false" th:checked="${filter.status == false}">
            <label for="statusInactive">Неактивный</label>
        </div>
    </div>
    <div>
        <label for="size">Записей на странице:</label>
        <select id="size" name="size" onchange="this.form.submit()">
            <option th:each="sizeOption : ${pageSizes}"
                    th:value="${sizeOption}"
                    th:text="${sizeOption}"
                    th:selected="${currentSize == sizeOption}">
            </option>
        </select>
    </div>
    <div>
        <input type="submit" value="Найти">
    </div>
</form>

<div th:if="${!usersPage.isEmpty()}">
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Имя пользователя</th>
            <th>Имя</th>
            <th>Фамилия</th>
            <th>Телефон</th>
            <th>Роль</th>
            <th>Статус</th>
            <th>Создан</th>
            <th>Обновлен</th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user : ${usersPage.content}">
            <td th:text="${user.id} ?: '–'"></td>
            <td th:text="${user.username} ?: '–'"></td>
            <td th:text="${user.firstName} ?: '–'"></td>
            <td th:text="${user.lastName} ?: '–'"></td>
            <td th:text="${user.phoneNumber} ?: '–'"></td>
            <td th:text="${user.role} ?: '–'"></td>
            <td th:text="${user.status} ? 'Активен' : 'Неактивен'"></td>
            <td th:text="${user.createdAt} ?: '–'"></td>
            <td th:text="${user.updatedAt} ?: '–'"></td>
            <td>
                <div th:if="${user.role.name() == 'USER'}">
                    <form th:action="@{/admin/role/{id}(id=${user.id})}" th:method="patch">
                        <input type="submit" value="Сделать админом">
                    </form>
                </div>
                <div th:if="${user.role.name() == 'ADMIN'}">
                    <form th:action="@{/admin/role/{id}(id=${user.id})}" th:method="patch">
                        <input type="submit" value="Убрать админа">
                    </form>
                </div>
                <div th:if="${user.status == true}">
                    <form th:action="@{/admin/status/{id}(id=${user.id})}" th:method="patch">
                        <input type="submit" value="Заблокировать">
                    </form>
                </div>
                <div th:if="${user.status == false}">
                    <form th:action="@{/admin/status/{id}(id=${user.id})}" th:method="patch">
                        <input type="submit" value="Разблокировать">
                    </form>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<div th:if="${usersPage.isEmpty()}">
    <p>Пользователи не найдены</p>
</div>

<div th:if="${usersPage.totalPages > 1}">
    <div>
        <span th:text="'Страница ' + (${usersPage.number} + 1) + ' из ' + ${usersPage.totalPages}"></span>
        <br>
        <a th:if="${usersPage.hasPrevious()}"
           th:href="@{/admin(username=${filter.username}, firstName=${filter.firstName}, lastName=${filter.lastName}, phoneNumber=${filter.phoneNumber}, role=${filter.role}, status=${filter.status}, page=${usersPage.number - 1}, size=${currentSize})}"
           href="#">Предыдущая</a>
        <span th:each="i : ${#numbers.sequence(0, usersPage.totalPages - 1)}">
                <a th:if="${i != usersPage.number}"
                   th:href="@{/admin(username=${filter.username}, firstName=${filter.firstName}, lastName=${filter.lastName}, phoneNumber=${filter.phoneNumber}, role=${filter.role}, status=${filter.status}, page=${i}, size=${currentSize})}"
                   th:text="${i + 1}"></a>
                <span th:if="${i == usersPage.number}" th:text="${i + 1}"></span>
            </span>
        <a th:if="${usersPage.hasNext()}"
           th:href="@{/admin(username=${filter.username}, firstName=${filter.firstName}, lastName=${filter.lastName}, phoneNumber=${filter.phoneNumber}, role=${filter.role}, status=${filter.status}, page=${usersPage.number + 1}, size=${currentSize})}"
           href="#">Следующая</a>
    </div>
</div>
</body>
</html>